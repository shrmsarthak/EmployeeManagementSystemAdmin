{% extends 'base.html' %}

{% block content %}

<br>

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="card p-3 p-md-4 bg-dark text-white">
                <h4 class="mb-3 text-center">View Employee</h4>
                <div class="d-flex justify-content-center mb-3">
                    <button class="btn btn-primary btn-sm" onclick="viewAllLocations()">View All Locations</button>
                </div>
                <div id="allLocationsMap" style="height: 500px; width: 100%; display: none;" class="mb-3"></div>

                <!-- Table without Scrolling -->
                <!-- Table without Scrolling -->
                <div class="table-responsive">
                    <table class="table table-striped table-dark table-bordered text-center text-nowrap">
                        <thead>
                            <tr>
                                <th scope="col" class="text-center">Employee Email</th>
                                <th scope="col" class="text-center">Employee Name</th>
                                <th scope="col" class="text-center">Employee Phone</th>
                                <th scope="col" class="text-center">Employee Code</th>
                                <th scope="col" class="text-center">Employee Unit</th>
                                <th scope="col" class="text-center">Latitude</th>
                                <th scope="col" class="text-center">Longitude</th>
                                <th scope="col" class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if employees %}
                            {% for email, employee in employees.items() %}
                            <tr>
                                <td class="text-center" style="word-wrap: break-word;">{{ employee.email }}</td>
                                <td class="text-center">{{ employee.name }}</td>
                                <td class="text-center">{{ employee.phone }}</td>
                                <td class="text-center">{{ employee.employee_code }}</td>
                                <td class="text-center">{{ employee.employee_unit }}</td>
                                <td class="text-center">{{ employee.employee_latitude }}</td>
                                <td class="text-center">{{ employee.employee_longitude }}</td>
                                <td class="text-center">
                                    <!-- Action Buttons -->
                                    <div class="d-flex flex-wrap gap-1 justify-content-center">
                                        <form id="deleteForm-{{ email }}" method="POST"
                                            action="{{ url_for('delete_employee', email=email) }}">
                                            <input type="hidden" name="email" value="{{ email }}">
                                            <button type="button" class="btn btn-danger btn-sm"
                                                onclick="confirmDelete('{{ email }}')">Delete</button>
                                        </form>
                                        <a href="{{ url_for('view_location', latitude=employee.employee_latitude, longitude=employee.employee_longitude) }}"
                                            class="btn btn-info btn-sm">View</a>
                                        <a href="{{ url_for('edit_employee', email=email) }}"
                                            class="btn btn-warning btn-sm">Edit</a>
                                            <a href="{{ url_for('location_history', email=email) }}"
                                            class="btn btn-secondary btn-sm"
                                            style="min-width: 160px;">Location History</a>
                                         
                                    </div>

                                </td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="8" class="text-center">No employees found.</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- SweetAlert for Delete Confirmation -->
<script>
   
    function confirmDelete(email) {
        Swal.fire({
            title: 'Are you sure?',
            text: "This action cannot be undone!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById(`deleteForm-${email}`).submit();
            }
        });
    }



    // View Location using Google Maps
    function viewLocation(latitude, longitude) {
    const url = `https://www.google.com/maps?q=${latitude},${longitude}`;
    window.open(url, '_blank');
}

    // View All Locations using Google Maps
    function viewAllLocations() {
        window.location.href = "{{ url_for('view_all_locations') }}";
    }
</script>

{% endblock %}